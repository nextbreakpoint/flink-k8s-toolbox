{
  "cluster": {
    "supervisor": {
      "pullPolicy": "IfNotPresent",
      "image": "nextbreakpoint/flinkctl:1.4.3-beta",
      "serviceAccount": "flink-supervisor",
      "taskTimeout": 180,
      "rescaleDelay": 10,
      "replicas": 2,
      "resources": {
        "limits": {
          "cpu": "0.05",
          "memory": "200Mi"
        },
        "requests": {
          "cpu": "0.05",
          "memory": "200Mi"
        }
      }
    },
    "runtime": {
      "pullPolicy": "IfNotPresent",
      "image": "example/flink:1.9.2"
    },
    "jobManager": {
      "serviceMode": "NodePort",
      "annotations": {
        "managedBy": "flinkctl"
      },
      "environment": [
        {
          "name": "FLINK_JM_HEAP",
          "value": "256"
        },
        {
          "name": "FLINK_SAVEPOINTS_LOCATION",
          "value": "file:///var/savepoints"
        },
        {
          "name": "FLINK_CHECKPOINTS_LOCATION",
          "value": "file:///var/checkpoints"
        },
        {
          "name": "FLINK_FS_CHECKPOINTS_LOCATION",
          "value": "file:///var/fs_checkpoints"
        },
        {
          "name": "FLINK_S3_ENDPOINT",
          "value": "http://minio-headless:9000"
        },
        {
          "name": "FLINK_S3_PATH_STYLE_ACCESS",
          "value": "true"
        }
      ],
      "environmentFrom": [
        {
          "secretRef": {
            "name": "flink-secrets"
          }
        }
      ],
      "volumeMounts": [
        {
          "name": "config-vol",
          "mountPath": "/hadoop/etc/core-site.xml",
          "subPath": "core-site.xml"
        }
      ],
      "volumes": [
        {
          "name": "config-vol",
          "configMap": {
            "name": "flink-config"
          }
        }
      ],
      "extraPorts": [
        {
          "name": "prometheus",
          "containerPort": 9999,
          "protocol": "TCP"
        }
      ],
      "resources": {
        "limits": {
          "cpu": "1",
          "memory": "300Mi"
        },
        "requests": {
          "cpu": "0.2",
          "memory": "200Mi"
        }
      }
    },
    "taskManager": {
      "taskSlots": 2,
      "annotations": {
        "managedBy": "flinkctl"
      },
      "environment": [
        {
          "name": "FLINK_TM_HEAP",
          "value": "1024"
        },
        {
          "name": "FLINK_SAVEPOINTS_LOCATION",
          "value": "file:///var/savepoints"
        },
        {
          "name": "FLINK_CHECKPOINTS_LOCATION",
          "value": "file:///var/checkpoints"
        },
        {
          "name": "FLINK_FS_CHECKPOINTS_LOCATION",
          "value": "file:///var/fs_checkpoints"
        },
        {
          "name": "FLINK_S3_ENDPOINT",
          "value": "http://minio-headless:9000"
        },
        {
          "name": "FLINK_S3_PATH_STYLE_ACCESS",
          "value": "true"
        }
      ],
      "environmentFrom": [
        {
          "secretRef": {
            "name": "flink-secrets"
          }
        }
      ],
      "volumeMounts": [
        {
          "name": "config-vol",
          "mountPath": "/hadoop/etc/core-site.xml",
          "subPath": "core-site.xml"
        },
        {
          "name": "source-vol",
          "mountPath": "/tmp/workshop/sensor-events/data.csv",
          "subPath": "sensor-events.csv"
        }
      ],
      "volumes": [
        {
          "name": "config-vol",
          "configMap": {
            "name": "flink-config"
          }
        },
        {
          "name": "source-vol",
          "configMap": {
            "name": "flink-data",
            "defaultMode": 511
          }
        },
        {
          "name": "data-vol",
          "hostPath": {
            "path": "/data"
          }
        }
      ],
      "extraPorts": [
        {
          "name": "prometheus",
          "containerPort": 9999,
          "protocol": "TCP"
        }
      ],
      "resources": {
        "limits": {
          "cpu": "1",
          "memory": "1100Mi"
        },
        "requests": {
          "cpu": "0.2",
          "memory": "600Mi"
        }
      }
    }
  },
  "jobs": [
    {
      "name": "job-1",
      "spec": {
        "jobParallelism": 2,
        "savepoint": {
          "savepointMode": "Automatic",
          "savepointInterval": 3600,
          "savepointTargetPath": "s3a://flink/cluster-1/job-1/savepoints"
        },
        "restart": {
          "restartPolicy": "OnlyIfFailed",
          "restartDelay": 60,
          "restartTimeout": 120
        },
        "bootstrap": {
          "serviceAccount": "flink-bootstrap",
          "pullPolicy": "IfNotPresent",
          "image": "jobs:latest",
          "jarPath": "/flink-jobs.jar",
          "className": "com.nextbreakpoint.flink.jobs.stream.TestJob",
          "arguments": [
            "--CONSOLE_OUTPUT",
            "true"
          ],
          "resources": {
            "limits": {
              "cpu": "0.05",
              "memory": "200Mi"
            },
            "requests": {
              "cpu": "0.05",
              "memory": "200Mi"
            }
          }
        }
      }
    },
    {
      "name": "job-2",
      "spec": {
        "jobParallelism": 1,
        "savepoint": {
          "savepointMode": "Automatic",
          "savepointInterval": 0,
          "savepointTargetPath": "s3a://flink/cluster-1/job-2/savepoints"
        },
        "restart": {
          "restartPolicy": "Always",
          "restartDelay": 60,
          "restartTimeout": 120
        },
        "bootstrap": {
          "serviceAccount": "flink-bootstrap",
          "pullPolicy": "IfNotPresent",
          "image": "jobs:latest",
          "jarPath": "/flink-jobs.jar",
          "className": "com.nextbreakpoint.flink.jobs.stream.TestJob",
          "arguments": [
            "--CONSOLE_OUTPUT",
            "true"
          ],
          "resources": {
            "limits": {
              "cpu": "0.05",
              "memory": "200Mi"
            },
            "requests": {
              "cpu": "0.05",
              "memory": "200Mi"
            }
          }
        }
      }
    },
    {
      "name": "job-3",
      "spec": {
        "jobParallelism": 1,
        "savepoint": {
          "savepointMode": "Manual",
          "savepointInterval": 0,
          "savepointTargetPath": "s3a://flink/cluster-1/job-3/savepoints"
        },
        "restart": {
          "restartPolicy": "Never",
          "restartDelay": 60,
          "restartTimeout": 120
        },
        "bootstrap": {
          "serviceAccount": "flink-bootstrap",
          "pullPolicy": "IfNotPresent",
          "image": "jobs:latest",
          "jarPath": "/flink-jobs.jar",
          "className": "com.nextbreakpoint.flink.jobs.batch.ReportJob",
          "arguments": [
            "--CONSOLE_OUTPUT",
            "true",
            "--SOURCE_FS_PATH",
            "file:///tmp/workshop/sensor-events",
            "--OUTPUT_FS_PATH",
            "file:///tmp/workshop/report-events"
          ],
          "resources": {
            "limits": {
              "cpu": "0.05",
              "memory": "200Mi"
            },
            "requests": {
              "cpu": "0.05",
              "memory": "200Mi"
            }
          }
        }
      }
    }
  ]
}